implementation split between kernel and user mode
![[Win32 GUI Modules.png]]

- WIN32U implements syscall stubs in place of NTDLL
- Systemcalls implemented in WIN32K driver instead of NTOS kernel executive
- GUI APIs interact with Client Server Runtime Subsystem (CSRSS) which handles some privileged operations
## GUI Kernel Resources
4 types of kernel resources
1. Windows Stations - objects that represent the connection to the screen and user interface
2. Windows - GUI elements for interacting with the user, input, display
3. Desktops - Objects that represent the visible desktop
4. Drawing Resources - Bitmaps, fonts, anything else that needs to be displayed to the user
Querying names of stations and desktops
![[Windows Stations and Desktops.png]]
![[Windows ON current Desktop.png]]
## Window Messages
Sending a Window Message
![[Send Window Message.png]]
1. enumerate current desktop windows
2. allocate memory buffer for 2048 chars (16-bit unicode)
3. Send WM_GETTEXT message with `0xD`to query window captions
## Console Sessions
- Remote Desktop Services (RDS) allows remote connections to the GUI
- Kernel creates Session objects with references in the KernelObjects OMNS directory to track resources 
- 
```powershell
Get-NtProcess -InfoOnly | Group-Object SessionId
```